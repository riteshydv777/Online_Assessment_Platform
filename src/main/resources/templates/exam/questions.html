<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="layout/base :: body">
<head th:replace="layout/base :: head">
    <title>Manage Questions - Assessment Platform</title>
    <style>
        .question-list {
            max-height: 600px;
            overflow-y: auto;
        }
        .question-item {
            transition: all 0.3s ease;
        }
        .question-item:hover {
            transform: translateX(5px);
        }
        .options-list {
            list-style: none;
            padding-left: 0;
        }
        .option-item {
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        .option-item.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
    </style>
</head>
<body>
    <div th:fragment="content">
        <div class="container mt-4">
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="mb-0">Add New Question</h4>
                        </div>
                        <div class="card-body">
                            <form id="questionForm" th:action="@{/api/questions}" method="post">
                                <div class="mb-3">
                                    <label for="text" class="form-label">Question Text</label>
                                    <textarea class="form-control" id="text" name="text" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="type" class="form-label">Question Type</label>
                                    <select class="form-select" id="type" name="type" required>
                                        <option value="MULTIPLE_CHOICE">Multiple Choice</option>
                                        <option value="TRUE_FALSE">True/False</option>
                                        <option value="SHORT_ANSWER">Short Answer</option>
                                    </select>
                                </div>
                                <div id="optionsContainer" class="mb-3">
                                    <label class="form-label">Options</label>
                                    <div class="options-list">
                                        <div class="option-item d-flex align-items-center mb-2">
                                            <input type="text" class="form-control me-2" name="options[]" placeholder="Option text">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="correctOption" value="0">
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="addOption()">Add Option</button>
                                </div>
                                <div class="mb-3">
                                    <label for="points" class="form-label">Points</label>
                                    <input type="number" class="form-control" id="points" name="points" value="1" min="1" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Question</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4 class="mb-0">Questions</h4>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary btn-sm" onclick="filterQuestions('all')">All</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="filterQuestions('MULTIPLE_CHOICE')">Multiple Choice</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="filterQuestions('TRUE_FALSE')">True/False</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="filterQuestions('SHORT_ANSWER')">Short Answer</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="question-list">
                                <div th:each="question : ${questions}" 
                                     class="question-item card mb-3" 
                                     th:data-type="${question.type}">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <h5 class="card-title" th:text="${question.text}">Question text</h5>
                                            <div class="btn-group">
                                                <button class="btn btn-outline-primary btn-sm" th:onclick="'editQuestion(' + ${question.id} + ')'">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-outline-danger btn-sm" th:onclick="'deleteQuestion(' + ${question.id} + ')'">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <p class="card-text">
                                            <small class="text-muted">
                                                Type: <span th:text="${question.type}">Type</span> |
                                                Points: <span th:text="${question.points}">Points</span>
                                            </small>
                                        </p>
                                        <div th:if="${question.type == 'MULTIPLE_CHOICE'}" class="options-list">
                                            <div th:each="option, stat : ${question.options}" 
                                                 class="option-item"
                                                 th:classappend="${option.correct ? 'correct' : ''}">
                                                <span th:text="${option.text}">Option text</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        let optionCount = 1;

        function addOption() {
            const container = document.querySelector('.options-list');
            const newOption = document.createElement('div');
            newOption.className = 'option-item d-flex align-items-center mb-2';
            newOption.innerHTML = `
                <input type="text" class="form-control me-2" name="options[]" placeholder="Option text">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="correctOption" value="${optionCount}">
                </div>
            `;
            container.appendChild(newOption);
            optionCount++;
        }

        function filterQuestions(type) {
            const questions = document.querySelectorAll('.question-item');
            questions.forEach(question => {
                if (type === 'all' || question.dataset.type === type) {
                    question.style.display = 'block';
                } else {
                    question.style.display = 'none';
                }
            });
        }

        function editQuestion(id) {
            fetch(`/api/questions/${id}`)
                .then(response => response.json())
                .then(question => {
                    document.getElementById('text').value = question.text;
                    document.getElementById('type').value = question.type;
                    document.getElementById('points').value = question.points;
                    
                    const optionsContainer = document.querySelector('.options-list');
                    optionsContainer.innerHTML = '';
                    if (question.type === 'MULTIPLE_CHOICE') {
                        question.options.forEach((option, index) => {
                            const optionElement = document.createElement('div');
                            optionElement.className = 'option-item d-flex align-items-center mb-2';
                            optionElement.innerHTML = `
                                <input type="text" class="form-control me-2" name="options[]" value="${option.text}">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="correctOption" value="${index}" ${option.correct ? 'checked' : ''}>
                                </div>
                            `;
                            optionsContainer.appendChild(optionElement);
                        });
                    }
                });
        }

        function deleteQuestion(id) {
            if (confirm('Are you sure you want to delete this question?')) {
                fetch(`/api/questions/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Failed to delete question');
                    }
                });
            }
        }

        document.getElementById('questionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const questionData = {
                text: formData.get('text'),
                type: formData.get('type'),
                points: parseInt(formData.get('points')),
                options: Array.from(formData.getAll('options[]')).map((text, index) => ({
                    text: text,
                    correct: formData.get('correctOption') === index.toString()
                }))
            };

            fetch(this.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(questionData)
            })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Failed to save question');
                }
            });
        });

        document.getElementById('type').addEventListener('change', function(e) {
            const optionsContainer = document.getElementById('optionsContainer');
            if (e.target.value === 'MULTIPLE_CHOICE') {
                optionsContainer.style.display = 'block';
            } else {
                optionsContainer.style.display = 'none';
            }
        });
    </script>
</body>
</html> 